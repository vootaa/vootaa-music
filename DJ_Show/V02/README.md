# V02 概要与实施手册

目标：以音乐性为先，最小代码、强模块化、可复现的小幅变化、章节化 DJ 过渡与多鼓手对话为核心亮点。

## 1. 核心目标与原则

- 音乐性优先：稳定律动、清晰层次、适度空间感、可复现的细微惊喜。
- 极简主程序：主文件仅编排时间线/章节/宏参数；演奏与音色逻辑外置模块。
- 确定性伪随机：以无理数序列/相位（φ、√2、π 等）驱动微变，摒弃种子随机；同配置必复现。
- 预定义序列：鼓/贝斯/和声/旋律由 ring/模式库驱动，小变体随能量与相位切换。
- 样本合规：仅使用 SONIC Samples 清单中的符号样本（优先 drum_*/elec_*），统一增益。
- 峰值余量：混音保持 -6 ~ -9 dB 余量，避免过载。

## 2. 章节与段落模型（DJ 结构）

- 章节即周期：一个“章节” = 一个“音乐周期”。章节之间必须进行 DJ 过渡（A/B 总线等功率跨推 + 频域交接），避免突兀切换。
- 章节内三要素：每章拥有固定调式/母题与能量目标；非鼓片段只做“渲染与点缀”，鼓维持稳定锚点。
- 段落编排（每章包含以下段落，按需取舍与时长定制）：
  - Intro → Build → Drop A → Bridge → Drop B → Outro
  - Intro：铺陈氛围与调式；Build：能量与密度渐进；Drop A：主题首次完整呈现；
    Bridge：降密度与色彩过渡；Drop B：主题变体/二次峰值；Outro：冷却与收束。
- 章节过渡要求：跨章衔接必须先频域后能量（A: HPF 上行；B: LPF 下行）并保留回声尾；鼓层持续作为能量锚点。

## 3. 声部分层与职责

- Drums（主角）：底鼓/军鼓/踩镲/过门分层；稳定主型 + 少量 fill/ghost；多鼓手对话实现“舞台方位感”；swing：独立。
  - 大面积鼓手段落：直接继承 snippets_/drums.rb 的预置鼓型与人性化参数，作为整场秀的稳定性锚点与主要张力来源。
- Bass：根音导向的节型，小范围位移与装饰音；与和声进行同源。
- Harmony/Pad：长音/分解和弦交替，稀疏留白，滤波与混响缓慢自动化。
- Lead/Arp：占空比低、短句钩子，呼应主题；少量装饰音与延迟点缀。

## 4. 多鼓手系统（亮点）

- 方位与空间：为每名“鼓手”设定独立 pan、房间大小与预延时差，制造真实舞台感。
- 微时值与 swing：每鼓手独立 swing 深度与偏移，形成“你来我往”的人性化黏性。
- 对话/竞赛：call–response、trading 2/4/8、分区轮替填充；能量峰值触发短 fill。
- 总线处理：鼓总线轻度并行压缩 + 少量饱和；侧链轻微压 Pad/Bass，保证冲击。

## 5. 数学与动态函数（能量/参数自动化）

- 能量曲线：采用分段函数 + 平滑过渡（线性/指数/样条/贝塞尔/Logistic）驱动密度、力度、滤波截止、回声反馈与混响大小。
- 8 字型锚点：使用 Lissajous 或 Bernoulli lemniscate（x=sin(αt)、y=sin(βt+δ)）在两参数间联动（如 cutoff–res、wet–pan），形成跨章节周期性“锚点”与结构重复性。
- 无理比相位：α/β 取无理比（φ、√2 等），保证长周期不整齐重复但总体回到锚点；仅作用于参数层，不破坏节拍量化。
- 平滑与边界：所有自动化包络带 T60 渐变与限幅，避免泵音与突变。

## 6. 确定性伪随机与模式库

- 无理步进：对模式索引/力度/装饰触发使用无理数步进的取整/取模（如 frac(n·φ)→量化到离散集合）实现“伪随机”而可复现。
- 模式选择：主型 + 变体（fill、ghost、反拍、休止）；随能量曲线、章节索引与无理相位共同切换。
- 欧几里得 E(n,k,rot)：分配给踩镲/打击小件，配合步进旋转/镜像，互补律动。
- 相位与不同比例周期：参数级相位漂移（非音高/触发），制造长周期不重复。
- 低阶 Markov（受约束）：动机重排受调式、允许跳进与目标音集合约束，防止无序。

## 7. 非鼓类“可直接引用”的演奏片段（来自 examples）

- 适用性：在合适的章节/段落中插入以下片段，作为色彩与层次增强；统一采用第 8 节的淡入/交叉淡规则。
- Intro
  - ambient.rb：双和弦 Drone（主和弦→近亲和弦），滤波慢开合 + 长尾混响，8–16 小节。
  - ocean.rb：低频噪声海面 + 轻滤波摆动 + 极慢音量包络，偶发高频闪光，4–8 小节。
  - ambient_experiment.rb：玻璃感稀疏琶音（1–3–5–9 往返），dotted-8th 短延迟点缀，2–4 小节。
- Build
  - reich_phase.rb：双单音动机相位缓移，8 小节内织体摩擦渐显。
  - acid.rb：16 步 303 动机（轻滑音/重音），截止线性上扬，4–8 小节推向 Drop。
  - driving_pulse.rb：主音–五度踏垫，4/8 小结尾上/下滑半小节引导过门。
- Drop A
  - blip_rhythm.rb：1–3–5–8 极简琶音钩子，1/16 分辨率，弱三连/缺拍小绊步，4 小节一转位。
  - square_skit.rb：1–2–3–5–3–2–1 短句，超短 gate + 轻颤音，左右微摆，2–4 小节循环。
  - wob_rhyth.rb：一拍半 wob 低音插花，前半高后半低截止摆动，第 4/8 小节下勾收束。
- Bridge
  - chord_inversions.rb：近位置转位 I–vi–IV–V（或 i–VI–III–VII），4–8 小节稳态过桥。
  - echo_drama.rb：单音回声独白，高反馈乒乓延迟自建织体，2–4 小节悬停。
  - ambient_experiment.rb：调内 9/11/13 弱拍经过，下小节首拍回和弦内音，3–4 小节“走远又归”。
- Drop B
  - tron_bike.rb：sus2/sus4 与三和弦交替的格栅断奏，弱拍补三音，4–8 小节厚实推进。
  - rerezzed.rb：与 Drop A 同轮廓的锯齿变体，轻失真/饱和 + 截止“齿化”摆动，二次峰值。
  - fm_noise.rb：金属质滑音上行（0.5–1 小节），短门限回声收尾，段尾撞点。
- Outro
  - blimp_zones.rb：低频暖垫 5–4–3–2–1 缓降，超长尾混响，4–8 小节冷却。
  - ocean.rb：滤波噪声回潮：高频缓衰，2–4 小节清场。
  - bach.rb：3–2–1 两小节终止式，弱拍邻接音，优雅收束。

## 8. 片段引入与过渡（避免“惊吓”）

- 章节级过渡：跨章必须进行等功率 A/B 交叉淡入；先频域后能量（A：HPF 上行；B：LPF 下行）。
- 分层淡入：非鼓类片段均采用包络淡入（10–40 击拍），先开滤再提电平，避免“闯入感”。
- 等功率交叉淡入：片段/章节在 A/B 总线进行 equal-power crossfade；鼓层保持恒定锚点。
- 频域交接：交接中心频率与时长随能量曲线确定。
- 回声尾衔接：切换前后 1–2 小节保留短延迟尾与适度混响，隐藏边界。

## 9. 音乐理论约束（避免混沌）

- 调式与进行：每章固定（如 I–vi–IV–V / i–VI–III–VII），Pad/Arp/Lead 均从中取材。
- 重音规则：下拍优先和弦内音（1/3/5/7），弱拍可用 9/11/13、邻接与经过音。
- 旋律轮廓：级进/小跳优先；限制 > 六度跳进；句尾回到 1/5/3 收束。
- 装饰生成：无理相位/函数仅驱动时值与触发概率；最终量化到目标音阶与许可集合。

## 10. 时钟与同步

- 单一母时钟，所有 live_loop 以 cue/sync 小节对齐。
- 指针与索引：tick/knit 作为指针；变体选择随小节索引、能量与无理相位共同决定。
- 相位技巧：对齐强拍，漂移仅在参数（滤波、空间、摆动）与弱拍节件中使用。

## 11. FX 与混音规范

- 分层到专属 FX bus → 主混总线；避免多重 FX 叠加。
- 章节自动化：滤波截止、回声反馈、混响大小随能量曲线缓慢变化（参见第 5 节）。
- DJ 过渡：等功率跨推（A/B）；A：HPF 上行，B：LPF 下行；短延迟尾衔接。
- 峰值管理：目标 LUFS 适中、峰值 -6 ~ -9 dB，保留动态。

## 12. 样本与资源（SONIC Samples）

- 仅使用清单内符号样本，优先 drum_*（kick/snare/tom/cymbal/hat）、elec_* 等。
- 统一增益、必要时轻度修整；不新增外部样本。

## 13. 模块化代码结构（建议）

- main：时间线/章节编排 + 全局能量曲线 + A/B 过渡调度 + 无理相位配置。
- lib/clock：母时钟、cue/sync、计数器。
- lib/patterns：鼓/低/和/旋预置模式与变体选择器（含欧几里得/旋转）。
- lib/players：具体声部演奏器（人性化、力度/微时值抖动）。
- lib/effects：bus/FX 链与自动化曲线（含 8 字型联动）。
- lib/transitions：DJ 过渡（跨推子、滤波包络、回声尾、淡入/淡出）。
- lib/mix_buses：分组与总线、侧链关系。
- lib/scales：调式/和弦生成、转位与声部导向。
- lib/energy：全局能量与函数映射（线性/指数/样条/Logistic）。

## 14. 配置参数（集中管理）

- 全局：BPM、调式/音阶、总时长与各章时长、无理比向量（α/β/δ）、初始相位、swing 深度（每鼓手独立）。
- 8 字与自动化：Lissajous 比率、相位偏移、包络曲线类型、淡入/淡出时长、交叉淡参数。
- 混音：各总线电平、压缩/限幅阈值、侧链比率、过渡时长。
- 声部：各层启停、音量/声像、滤波范围、FX 上下限。
- 模式：鼓型/变体表、fill 周期、Euclid 参数、旋律/和声进行。

## 15. 与 V01 的取舍

- 保留：分层配器、能量曲线、单母时钟、鼓主导逻辑与可复现微变。
- 改进：以无理数序列替代种子随机；参数自动化引入函数族与 8 字联动；过渡全面淡入/交叉淡。
- 移除：基于随机种子的策略、冗长工具函数与重复逻辑、无约束的随机与过度 FX 堆叠。

## 16. 执行步骤（建议）

1) 设定全局与章节配置（BPM/调式/时长/无理比/初相/能量曲线/8 字参数）。  
2) 先搭建鼓主型与多鼓手对话（独立 swing），再补 Bass 与 Pad。  
3) 在合适的章节/段落插入第 7 节的“可直接引用”片段，并按第 8 节规则淡入。  
4) 配置 FX bus 与 A/B 过渡，设置交叉淡与频域交接；在 8/16 小节处做锚点检查。  
5) 校正峰值与余量，验证复现性（同无理比/初相→同结果）。  
6) 预演并记录需要手动触发的过渡点与静音/独奏。

——  
本手册为 V02 的“工程约束 + 音乐意图”文档：主文件只描述“何时发生什么”，细节由模块在严格约束下以最少代码完成。
