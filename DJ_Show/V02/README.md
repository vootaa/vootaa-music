# V02 的目标与方案

- 美学目标：以音乐性为先。稳定律动、清晰层次、适度空间感、可复现的细微随机与短期惊喜。
- 结构目标：主程序极简（时间线/章节/宏控制），一切演奏与音色逻辑外部模块化，参数集中配置。
- 确定性随机：每个章节/层设定；仅在受控点使用无理数驱动的确定性随机，确保可复现与可微调。
- 预定义序列：鼓/贝斯/和声/旋律用 rings 与模式库驱动，小变体（fill、ghost、反拍、休止）按种子与能量曲线选择。
- 章节化编排：Intro → Build → Drop A → Bridge → Drop B → Outro；每章限定音阶/和声色彩与主节奏母题，维持主题一致性。
- DJ 过渡与混合：
  - 等功率跨推子主混音（A/B bus），保持能量平滑。
  - 频域交接（A 上行 HPF，B 下行 LPF）与短回声尾衔接。
  - 微弱门限/侧链感（节拍触发的轻度衰减）保持节奏黏性。
  - 仅使用 SONIC Samples 中列明的样本做过带、反转、回卷等点缀。
- 能量与动态：全局能量曲线驱动密度、力度、滤波截止、回声反馈与混响大小；保持 -6 至 -9 dB 峰值余量。
- 时钟与同步：单一母时钟与小节对齐；所有 live_loop 以 cue/sync 精准对齐；tick/knit 控指针，避免游离。
- 声部分层：
  - Drums：底鼓/军鼓/踩镲/过门分层，模式最小但可注入 fill。
  - Bass：与和声根音绑定的节型，小范围节奏位移与音高装饰。
  - Harmony/Pad：长音与分解和弦交替，稀疏留白。
  - Lead/Arp：稀释占空比，短句呼应主题，尽量减法。
- 效果总线：每层到专属 FX bus，再到主混；常用混响/回声/滤波，参数随章节自动化；避免多重 FX 叠加。
- Swing 与微变：可选全局 swing（hi-hat/ghost 专用），力度与时值小抖动受种子与能量控制。
- 配置与可控参数：BPM、调式/音阶、章节时长、种子表、总线电平、过渡时长、swing 深度、FX 范围，统一在配置模块集中管理。
- 代码组织（建议）：
  - main：时间线编排 + 章节调用 + 全局种子与能量曲线。
  - lib/modules：clock、patterns、players、transitions、mix_buses、effects、scales、energy。
  - patterns：仅存放模式与变体选择器；players 负责演奏与人性化。
- 参考与约束：
  - 严格使用 SONIC Samples 清单内样本。
  - 借鉴 examples 与 snippets_ 的节奏/相位/FX 自动化技巧，但接口统一、代码最小化。
  - 保留 V01 中有效的能量曲线与分层思想，去除冗余工具函数与复杂度。

结果：一套可复现、章节化、可现场混合的 DJ 套曲骨架；主文件只描述“何时发生什么”，音乐细节在模块内以最少代码完成。

## 补充总结与可执行要点

### V01 核心思路

- 分层配器 + 能量曲线驱动编排（有效，需保留）。
- 单母时钟 + cue/sync 对齐，若干 live_loop 协同。
- 鼓主导的稳定律动，其他声部围绕主题做密度与装饰变化。
- 有人性化微变与随机，但控制粒度不够、工具函数与逻辑偏冗长。

### examples 可借鉴的创作与演奏技巧

- reich_phase.rb：相位漂移/相位错位营造张力与推进。
- acid.rb：303型序列（门限、滑音、重音）+ 滤波自动化。
- filtered_dnb.rb / jungle.rb / loop_amen 系：amen/断拍切片、滤波+压限塑形。
- idm_breakbeat.rb：切片重排、位移与变速，制造break的“碎裂”感。
- echo_drama.rb / ambient.rb / ocean.rb：回声-混响-滤波的层次化空间与尾音衔接。
- chord_inversions.rb：和弦转位与低音导向，减少跳进、改善连贯。
- fm_noise.rb / wob_rhyth.rb：调制（FM/LFO）驱动音色演变和节奏抖动。
- time_machine.rb / shufflit.rb：全局节拍与 swing 量化控制。
- bach.rb / ambient_experiment.rb：主题动机→微变体→重组的极简写法。

### snippets_ 可直接使用的方法

- drums.rb：多套预置鼓型（底鼓/军鼓/hi-hat/填充/ghost），力度与微时值变化，稳定秀场基底。
- heartbeats.rb：心跳型脉动与宏动态包络，可做能量曲线锚点。
- c_major_scale.rb：音阶/级数映射、和弦拼接与量化，保障调性与和声约束。
- basic_random.rb：种子化随机与 ring 选择器，便于“可复现的小惊喜”。

### 数学方法与演变模式（为多样性服务）

- 确定性随机：章节/声部独立种子表；仅在节拍、力度、音高装饰等关键点投放。
- 欧几里得节奏（E(n,k,rot)）与步进旋转/镜像/倒影，形成多鼓手互补律动。
- 相位与不同比例周期：用无理比值（如 φ、√2）驱动微漂移，制造长周期不重复。
- 低阶 Markov + 约束（调式、允许跳进、目标音）做动机微重排。
- 连续调制：正弦/三角/LFO 与平滑噪声驱动 cutoff、反馈、混响大小等宏参数。

### 旋律/和声策略（静态为主，花句受控）

- 每章节固定和声色彩/进行（I–vi–IV–V 等），Pad 与 Arp 从中取材。
- 下拍优先和弦内音（1/3/5/7），弱拍可用 9/11/13 与半音级邻接、经过音。
- 轮廓与连音：优先级进/小跳，限制 > 六度跳进；句尾回到 1/5/3 收束。
- 花句生成：在限定小节窗内，用无理数/LFO 决定时值与装饰音触发；最终量化到目标音阶与允许集合，避免失控。

### 全局稳定性与“多鼓手”亮点（鼓为主角）

- 多鼓手分轨与空间定位：各自 pan/房间大小/预延时差异，制造方位感。
- 微时值与 swing 差异：每名鼓手独立 swing 深度与偏移，形成“你来我往”。
- 对话与竞赛：call-response、trading 2/4/8、分区填充轮替；能量峰值触发短 fill。
- 频域与总线：鼓总线轻度并行压缩+少量饱和；侧链轻微压 Pad/Bass 保持冲击。
- 样本限制：仅用 SONIC Samples 列表中的 bd_*/sn_*/hat_*/ride_* 与必要 loops，统一增益，留 -6~-9 dB 余量。
- 落地到 V02：
-- 主程序只排时间线与章节参数；鼓/低/和/旋与过渡、FX、模式选择全转外部模块；
-- 以确定性伪随机+模式库+能量曲线驱动“小步可复现的变化”，在鼓手多声部的对话里完成DJ级过渡与张力管理。

### examples 非鼓类演奏片段

- 面向章节的“可直接拿来用”的非鼓类演奏片段清单
- 源自 examples 的风格与素材取向，聚焦旋律/和声/质感/FX 段落

Intro（开场铺陈/氛围建立）

[ambient.rb] 双和弦 Drone 片段：主和弦→近亲和弦（i→iv 或 I→V），缓慢开合滤波，长尾混响与微弱合唱，8–16 小节静态推进。
[ocean.rb] 噪声海面起伏：低频噪声+轻度滤波摆动+极慢脉动音量包络，偶发高频泛音闪烁，形成自然“呼吸”，4–8 小节。
[ambient_experiment.rb] 玻璃感琶音点缀：稀疏的1/2或1/4音符间距，小范围度数（1–3–5–9）往返，叠加短延迟（dotted-8th），2–4 小节作为空白处的亮点。
Build（能量蓄势/动机显影）

[reich_phase.rb] 两音细胞相位推进：两条同素材单音动机（如主音–五度），其中一条以极轻微相位错位缓慢前移，8 小节内渐显“织体摩擦”。
[acid.rb] 303 前奏动机：16 步短句（重点在第 4/8/12 步轻微滑音与重音），截止频率线性上扬，4–8 小节把能量推向 Drop。
[driving_pulse.rb] 脉动式低音踏垫：主音–五度反复短时值（占空比低），在第 4/8 小结尾加入上滑/下滑半小节引导过门。
Drop A（主题呈现/律动主陈述）

[blip_rhythm.rb] 1–3–5–8 极简琶音钩子：1/16 等分，弱三连或缺拍制造小“绊步”，每 4 小节用一次级进转位，维持抓耳且不拥挤。
[square_skit.rb] 方波主旋短句：音序 1–2–3–5–3–2–1，极短 gate 与轻度颤音，左右微摆（pan）的呼吸感，2–4 小节循环。
[wob_rhyth.rb] 一拍半 Wob 低音插花：主音重申+降七借位的两音回应，LFO 截止在小节前半高、后半低，作为第 4/8 小节的“下勾”收束。
Bridge（降密度/色彩过渡）

[chord_inversions.rb] 近位置转位铺垫：I–vi–IV–V（或 i–VI–III–VII）以顶声部级进为原则，长音垫底，4–8 小节过桥稳态。
[echo_drama.rb] 单音回声独白：每小节仅 1–2 个音，利用高反馈的乒乓延迟自建织体，2–4 小节制造空间“悬停”。
[ambient_experiment.rb] 偏不协与还原：在调内添加 9/11/13 作弱拍经过，下一和弦首拍立即回到和弦内音，3–4 小节“走远又归”的过渡。
Drop B（主题变体/能量再峰）

[tron_bike.rb] 短突音和弦推进：sus2/sus4 与原三和弦交替的“格栅”式断奏，16 步里仅在弱拍补三音，既厚实又不遮主旋。
[rerezzed.rb] 粗糙锯齿主旋变体：与 Drop A 动机同轮廓但加轻度失真/饱和，截止做“锯齿齿化”摆动，4–8 小节形成二次峰值。
[fm_noise.rb] 金属杂色上行动效：半至一小节长度的金属质感滑音上行，尾接短门限回声，作为 8 或 16 小节段尾的撞点。
Outro（退场/余韵）

[blimp_zones.rb] 低频暖垫下行线：5–4–3–2–1 级进缓降，超长尾混响，4–8 小节自然冷却。
[ocean.rb] 滤波噪声回潮：高频缓慢衰减，仅保留中低频“海浪”包络，2–4 小节尾音清场。
[bach.rb] 收束两小节终止式：3–2–1 的简短终止动机，弱拍加入和弦内邻接音，优雅收尾。
