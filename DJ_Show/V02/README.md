# V02 概要与实施手册

目标：以音乐性为先，最小代码、强模块化、可复现的小幅变化、章节化 DJ 过渡与多鼓手对话为核心亮点。

## 1. 核心目标与原则

- 音乐性优先：稳定律动、清晰层次、适度空间感、可复现的细微惊喜。
- 极简主程序：主文件仅编排时间线/章节/宏参数；演奏与音色逻辑外置模块。
- 决定性随机：章节/声部独立种子；随机仅在受控点投放；可复现、可微调。
- 预定义序列：鼓/贝斯/和声/旋律由 ring/模式库驱动，小变体随能量与种子切换。
- 样本合规：仅使用 SONIC Samples 清单中的符号样本（优先 drum_*/elec_*），统一增益。
- 峰值余量：混音保持 -6 ~ -9 dB 余量，避免过载。

## 2. 章节化时间线（建议）

Intro → Build → Drop A → Bridge → Drop B → Outro  
每章固定调式/母题与能量目标；过渡用 A/B 主总线等功率跨推、频域交接（A: HPF 上行；B: LPF 下行）与短回声尾衔接。

## 3. 声部分层与职责

- Drums（主角）：底鼓/军鼓/踩镲/过门分层；稳定主型 + 少量 fill/ghost；多鼓手对话实现“舞台方位感”。
- Bass：根音导向的节型，小范围位移与装饰音；与和声进行同源。
- Harmony/Pad：长音/分解和弦交替，稀疏留白，滤波与混响缓慢自动化。
- Lead/Arp：占空比低、短句钩子，呼应主题；少量装饰音与延迟点缀。

## 4. 多鼓手系统（亮点）

- 方位与空间：为每名“鼓手”设定独立 pan、房间大小与预延时差，制造真实舞台感。
- 微时值与 swing：独立 swing 深度与偏移，形成“你来我往”的人性化黏性。
- 对话/竞赛：call–response、trading 2/4/8、分区轮替填充；能量峰值触发短 fill。
- 总线处理：鼓总线轻度并行压缩 + 少量饱和；侧链轻微压 Pad/Bass，保证冲击。

## 5. 决定性随机与模式库

- 种子策略：全局种子 + 章节/声部子种子表；切章必复位，确保重复演出一致。
- 模式选择：主型 + 变体（fill、ghost、反拍、休止）；随能量曲线/小节位置切换。
- 欧几里得 E(n,k,rot)：分配给踩镲/打击小件，配合步进旋转/镜像，互补律动。
- 相位与不同比例周期：用无理比（φ、√2）驱动参数或节奏微漂移（不直接用于音高），制造长周期不重复。
- 低阶 Markov（受约束）：动机重排时仍受调式、允许跳进与目标音集合约束。

## 6. 非鼓类“可直接引用”的演奏片段（来自 examples）

- Intro
  - ambient.rb：双和弦 Drone（主和弦→近亲和弦），滤波慢开合 + 长尾混响，8–16 小节。
  - ocean.rb：低频噪声海面 + 轻滤波摆动 + 极慢音量包络，偶发高频闪光，4–8 小节。
  - ambient_experiment.rb：玻璃感稀疏琶音（1–3–5–9 往返），dotted-8th 短延迟点缀，2–4 小节。
- Build
  - reich_phase.rb：双单音动机相位缓移，8 小节内织体摩擦渐显。
  - acid.rb：16 步 303 动机（轻滑音/重音），截止线性上扬，4–8 小节推向 Drop。
  - driving_pulse.rb：主音–五度踏垫，4/8 小结尾上/下滑半小节引导过门。
- Drop A
  - blip_rhythm.rb：1–3–5–8 极简琶音钩子，1/16 分辨率，弱三连/缺拍小绊步，4 小节一转位。
  - square_skit.rb：1–2–3–5–3–2–1 短句，超短 gate + 轻颤音，左右微摆，2–4 小节循环。
  - wob_rhyth.rb：一拍半 wob 低音插花，前半高后半低截止摆动，第 4/8 小节下勾收束。
- Bridge
  - chord_inversions.rb：近位置转位 I–vi–IV–V（或 i–VI–III–VII），4–8 小节稳态过桥。
  - echo_drama.rb：单音回声独白，高反馈乒乓延迟自建织体，2–4 小节悬停。
  - ambient_experiment.rb：调内 9/11/13 弱拍经过，下小节首拍回和弦内音，3–4 小节“走远又归”。
- Drop B
  - tron_bike.rb：sus2/sus4 与三和弦交替的格栅断奏，弱拍补三音，4–8 小节厚实推进。
  - rerezzed.rb：与 Drop A 同轮廓的锯齿变体，轻失真/饱和 + 截止“齿化”摆动，二次峰值。
  - fm_noise.rb：金属质滑音上行（0.5–1 小节），短门限回声收尾，段尾撞点。
- Outro
  - blimp_zones.rb：低频暖垫 5–4–3–2–1 缓降，超长尾混响，4–8 小节冷却。
  - ocean.rb：滤波噪声回潮，高频缓衰，2–4 小节清场。
  - bach.rb：3–2–1 两小节终止式，弱拍邻接音，优雅收束。

## 7. 音乐理论约束（避免混沌）

- 调式与进行：每章固定（如 I–vi–IV–V / i–VI–III–VII），Pad/Arp/Lead 均从中取材。
- 重音规则：下拍优先和弦内音（1/3/5/7），弱拍可用 9/11/13、邻接与经过音。
- 旋律轮廓：级进/小跳优先；限制 > 六度跳进；句尾回到 1/5/3 收束。
- 装饰生成：无理数/LFO 仅驱动时值/触发概率；最终量化到目标音阶与许可集合。

## 8. 时钟与同步

- 单一母时钟，所有 live_loop 以 cue/sync 小节对齐。
- tick/knit 作为指针；变体选择随小节索引、能量与种子共同决定。
- 相位技巧：对齐强拍，漂移仅在高层参数（滤波、空间、摆动）与弱拍节件中使用。

## 9. FX 与混音规范

- 分层到专属 FX bus → 主混总线；避免多重 FX 叠加。
- 章节自动化：滤波截止、回声反馈、混响大小随能量曲线缓慢变化。
- DJ 过渡：等功率跨推（A/B）；A：HPF 上行，B：LPF 下行；短延迟尾衔接。
- 峰值管理：目标 LUFS 适中、峰值 -6 ~ -9 dB，保留动态。

## 10. 样本与资源（SONIC Samples）

- 仅使用清单内符号样本，优先 drum_*（kick/snare/tom/cymbal/hat）、elec_* 等。
- 统一增益、必要时轻度修整；不新增外部样本。

## 11. 模块化代码结构（建议）

- main：时间线/章节编排 + 全局种子与能量曲线 + A/B 过渡调度。
- lib/clock：母时钟、cue/sync、计数器。
- lib/patterns：鼓/低/和/旋预置模式与变体选择器（含欧几里得/旋转）。
- lib/players：具体声部演奏器（人性化、力度/微时值抖动）。
- lib/effects：bus/FX 链与自动化曲线。
- lib/transitions：DJ 过渡（跨推子、滤波包络、回声尾）。
- lib/mix_buses：分组与总线、侧链关系。
- lib/scales：调式/和弦生成、转位与声部导向。
- lib/energy：全局能量曲线与参数映射。

## 12. 配置参数（集中管理）

- 全局：BPM、调式/音阶、总时长与各章时长、全局/分章随机种子、swing 深度。
- 混音：各总线电平、压缩/限幅阈值、侧链比率、过渡时长。
- 声部：各层启停、音量/声像、滤波范围、FX 上下限。
- 模式：鼓型/变体表、fill 触发周期、Euclid 参数、旋律/和声进行。

## 13. 与 V01 的取舍

- 保留：分层配器、能量曲线、单母时钟、鼓主导逻辑与可复现微变。
- 改进：随机与变体的粒度与可控性、模块边界、参数集中、主程序精简。
- 移除：冗长工具函数与重复逻辑、无约束的随机与过度 FX 堆叠。

## 14. 执行步骤（建议）

1) 设定全局与章节配置（BPM/调式/时长/种子/能量曲线）。  
2) 先搭建鼓主型与多鼓手对话，再补 Bass 与 Pad。  
3) 选择本 README 第 6 节中的非鼓片段给各章定调。  
4) 配置 FX bus 与 A/B 过渡，做 8/16 小节处的锚点检查。  
5) 校正峰值与余量，验证复现性（相同种子→同结果）。  
6) 预演并记录需要手动触发的过渡点与静音/独奏。

——  
本手册为 V02 的唯一“工程约束 + 音乐意图”文档：主文件只描述“何时发生什么”，细节由模块在严格约束下以最少代码完成。
