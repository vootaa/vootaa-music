# 面向音乐性的精炼功能策划

目的：完成一场“多鼓手 DJ 秀”，最大化复用SONIC PI examples 的高音乐性片段；鼓为主角，非鼓片段以淡入方式增色；数学驱动仅用于加花/装饰。

## 总体结构与时间线

- 章节即周期：建议 6 个章节（Ch1–Ch6），每章 64–96 小节；每章固定调式/母题/能量目标。
- 段落模型：每章按 Intro → Build → Drop A → Bridge → Drop B → Outro 执行。
- 过渡规范：跨章等功率 A/B 跨推 + 频域交接（A: HPF 上行；B: LPF 下行），16–32 小节淡入，保留回声尾。
- BPM：124–130；若变速，≤2 BPM/32 小节线性过渡，鼓锚点不变。

## 多鼓手设计（主角）

- 分工/方位：Drum A（Kick+Snare，pan C-5），Drum B（Hi-hat/Ride，pan L-20），Drum C（Perc/Tom/Cowbell，pan R-20）。
- swing/微时值：A=52%，B=54%，C 直拍但 ±6 ms 抖动（弱拍/装饰）；强拍量化。
- 律动骨架：四拍底鼓或“反四拍/破拍”；帽 Euclid E(16,9,rot)，ride E(12,5,rot)；每 8/16 小节 φ 相位触发短 fill。
- call–response：第 4/8 小节 A↔C 互答；段尾 trading 2/4。
- 样本限制：仅 SONIC Samples 符号样本。

## 鼓引擎与预置模式库（逐击控制；不使用 loop）

- 引擎目标：逐击可控（力度/时值/声像/房间/摆动），多鼓手对话、fill/过门、A/B 过渡、淡入规则一体化，听感≥ snippets_/drums.rb。
- 预置主型分类（示例规模）
  - House/Techno（8+）：4-on-floor、off-beat hat、shuffle、反拍军鼓、线性填充。
  - Breaks/Jungle/DnB（8+）：two-step、amen 轮廓重组、ghost-snare 织体、ride 推进、tom 反拍。
  - Hip-hop/Trap/Half-time（6+）：boom-bap、half-time 滚奏、triplet 句法、弱拍 clap 阴影。
  - Afro/Latin/Tribal（4+）：3–2/2–3 clave、tom 交替、splash 点睛。
  - Fill 库（12+）：1/2/4 小节过门、snare roll（渐强/破音色）、tom run-up、crash 落点。
- 变体轴：密度、ghost 比例、力度曲线、摆动深度、开闭镲占比、fill 周期（与能量映射）。
- 人性化：微时值仅作用弱拍/装饰；强拍严格量化；小幅 pan 摆动；章节切换时回到锚点。
- 可用性：主程序按名称启用主型+fill（如 house_4f_k1 + fill_tom_run）；章节自动切换 Kit 与 swing 档。
- 合规声明：不使用 :loop_compus/:loop_tabla/:loop_safari 等 loop_*；以 drum_* 系列样本逐击重建更高可控度的鼓感。

## 样本与鼓组方案（基于 SONIC Samples）

- Kit A（Warm Club，Ch1/Ch4）：:drum_heavy_kick, :drum_snare_hard, :drum_cymbal_closed, :drum_cymbal_open, :drum_cymbal_pedal, :drum_tom_lo_soft
- Kit B（Tight Tech，Ch2/Ch5）：:drum_bass_soft, :drum_snare_soft, :drum_cymbal_closed, :drum_cymbal_soft, :drum_tom_mid_hard
- Kit C（Gritty Breaks，Ch3/Ch6）：:drum_heavy_kick, :drum_snare_hard, :drum_tom_hi_hard, :drum_splash_hard, :drum_cymbal_hard
- 组合策略：章内默认使用 Kit；段尾/过门临时加入 tom/splash；Crash 稀用（仅峰值点）；统一增益与频域占位。

## 章节策划（最大化复用 Sonic PI examples 段落）

说明：所有非鼓片段统一淡入 10–40 拍，先滤后电平，置于非强拍窗口。

- Chapter 1（暖场与首主题，Am Aeolian，Kit A）
  - Intro：ambient.rb（双和弦 Drone）+ ocean.rb（低频噪声起伏），16–32 小节
  - Build：reich_phase.rb（双单音相位）→ acid.rb（16 步轻滑音，截止上扬），16–32 小节
  - Drop A：blip_rhythm.rb（1–3–5–8 钩子）配稳底鼓，32 小节
  - Bridge：chord_inversions.rb（I–vi–IV–V）+ echo_drama.rb（单音回声），16 小节
  - Drop B：square_skit.rb（1–2–3–5–3–2–1）+ wob_rhyth.rb（1.5 拍 wob 低音），32 小节
  - Outro：time_machine.rb（轻摆动门限）短尾，8–16 小节

- Chapter 2（推进与格栅对比，D Dorian，Kit B）
  - Intro/Build：driving_pulse.rb（主音–五度踏垫）叠 ride，16–32 小节
  - Drop A：tron_bike.rb（sus2/sus4 断奏格栅），32 小节
  - Bridge：ambient_experiment.rb（9/11/13 经过“走远又归”），16 小节
  - Drop B：rerezzed.rb（锯齿变体）+ fm_noise.rb（金属上行撞点），32 小节
  - Outro：shufflit.rb（轻摇摆格局减密），8–16 小节

- Chapter 3（Breaks 与织体摩擦，Gm Aeolian，Kit C）
  - Intro：ocean.rb（低频回潮）+ ambient_experiment.rb（稀疏琶音），16 小节
  - Build：filtered_dnb.rb 或 jungle.rb（滤波断拍推进），16–32 小节
  - Drop A：idm_breakbeat.rb（碎拍重排）与鼓 C tom 轮替，32 小节
  - Bridge：echo_drama.rb（高反馈乒乓独白），16 小节
  - Drop B：compus_beats.rb（几何节型叠加）+ wob_rhyth.rb 插花，32 小节
  - Outro：tilburg_2.rb（稀疏节格落地），8–16 小节

- Chapter 4（303 再现与明亮推进，C Ionian，Kit A）
  - Intro：ambient.rb（和声明亮版，转至大调），16 小节
  - Build：acid.rb（更高截止区间，轻失真），16–32 小节
  - Drop A：blip_rhythm.rb（高八度/转位），32 小节
  - Bridge：chord_inversions.rb（I–V–vi–IV），16 小节
  - Drop B：tron_bike.rb（格栅再现）+ fm_noise.rb 段尾撞点，32 小节
  - Outro：time_machine.rb（窗函数式淡出），8–16 小节

- Chapter 5（和声运动与旋律呼应，F Lydian，Kit B）
  - Intro/Build：ambient_experiment.rb（Lydian 高四度色彩），16–32 小节
  - Drop A：square_skit.rb（短句钩子）配分解和弦，32 小节
  - Bridge：echo_drama.rb（空间悬停）+ chord_inversions.rb（近位置转位），16 小节
  - Drop B：rerezzed.rb（齿化摆动）+ blip_rhythm.rb（节奏位移变体），32 小节
  - Outro：blimp_zones.rb（5–4–3–2–1 缓降），8–16 小节

- Chapter 6（收束与主题回归，Am 回到起点，Kit C）
  - Intro：ocean.rb（滤波噪声回潮），8–16 小节
  - Build：reich_phase.rb（相位复现，速度更慢），16 小节
  - Drop A：tron_bike.rb（与主题轮廓同拍），32 小节
  - Bridge：ambient_experiment.rb（弱拍经过后回主和弦），16 小节
  - Drop B（终峰）：rerezzed.rb + wob_rhyth.rb（重截止摆动），32 小节
  - Final Outro：blimp_zones.rb + bach.rb（3–2–1 终止式），16 小节

## 鼓层与 PI 片段的职责划分与时序编排

### 1. 职责边界与时序总览

- 鼓层（Drums）：能量锚点、节拍框架、舞台方位；目标占比 55–65%（演出总时长）。
- PI 片段（Sonic PI examples）：色彩、旋律钩子、空间渲染；目标占比 35–45%。禁止单独占据整小节，必须与鼓层或 Bass/Harmony 叠加。
- 段落规则（摘要）：
  - Intro / Bridge：允许纯 PI（≤16 小节）。
  - Build：必须包含鼓层（至少 Drummer A 轻底鼓）。
  - Drop A/B：鼓层为主，PI 片段点缀（占空比 ≤30%）。
  - Outro：鼓层在 8 小节内淡出，PI 接管收束。
- 时长配比示例（每章 80 小节）：
  - 鼓层：44–52 小节（55–65%）
  - PI 片段：28–36 小节（35–45%）
  - 叠加区：8–16 小节

### 2. 淡入 / 淡出包络标准

PI 片段淡入（强制）

- 频域先行：启动前 4–8 拍开启滤波（LPF 800 Hz→全频 或 HPF 1200→120 Hz）。
- 电平跟随：频域完全打开后电平从 -12 dB 线性升至目标，耗时 6–12 拍。
- 触发窗口：优先弱拍（如 2.5、4.5 拍）或小节末触发，避免与鼓强拍冲突。
- 回声尾衔接：启动前 1–2 小节保留前序短延迟尾（decay 0.3–0.5）作为“预告”。

鼓层淡入（章节首次启动）

- 前 2 小节：仅底鼓（Drummer A），力度 0.6→1.0。
- 第 3–4 小节：加入军鼓（Drummer A）与踩镲（Drummer B）。
- 第 5–8 小节：Drummer C 的 Perc/Tom 开始 fill 预热。
- 禁止突然全鼓启动（除非前序为 Drop B 峰值）。

淡出（章节收束）

- 最后 8 小节：鼓层力度线性降至 0.4，密度减半（hat 改为半拍）。
- 最后 4 小节：仅保留底鼓（1、3 拍），其余静音。
- PI 接管：鼓层淡出第 4–6 小节内，PI 片段（如 blimp_zones、bach）同步淡入。

### 3. 叠加区的频段与空间避让

频段分配（并存时，Drop A/B）

- 鼓层：20–200 Hz（Kick）；200–600 Hz（Snare/体）；8–15 kHz（Hi-hat/Ride）。
- PI 片段：400–2000 Hz（旋律/和声主体）；5–8 kHz（装饰高频）。
- Bass：30–150 Hz，底鼓侧链 -2.5 ~ -4 dB（视感知调整）。

空间设置

- 鼓总线：房间 size 0.2–0.3，干湿 90:10；尽量居中但避免与主旋律同位。
- PI 片段：房间 size 0.6–0.8，干湿 60:40；Pan 轻微错位 ±10–30°。
- 禁止鼓与 PI 片段同时占据中央声像。

动态避让（侧链）

- 底鼓触发：PI 片段与 Bass 自动压缩约 -2.5 dB（attack 5 ms，release 150 ms）。
- 军鼓 / Crash 触发：Pad/Arp 轻微压缩约 -1.5 dB。

### 4. 章节内段落切换（微过渡）

Intro → Build

- 最后 2 小节引入 Drummer A 轻底鼓（力度 0.5）作“打桩”。
- PI 片段（例如 reich_phase）第 1 小节同步启动，电平从 -9 dB 淡入。

Build → Drop A

- 最后 1 小节：PI 片段（acid）截止上扬至峰值；Drummer B 启动 hat roll（16 分）。
- Drop A 第 1 拍：全鼓齐奏 + Crash；PI 片段切换至 blip_rhythm（无淡入以制造爆发感）。

Drop A → Bridge

- 最后 4 小节：鼓层密度减半，Drummer C 触发 tom run fill。
- Bridge 第 1 小节：鼓层静音，PI 片段（chord_inversions）在弱拍（2.5 拍）淡入。

Bridge → Drop B

- 最后 2 小节：和弦回到主和弦，Drummer A 恢复底鼓（1、3 拍）。
- Drop B 第 1 拍：全鼓恢复；PI 片段（rerezzed）叠加但电平降至 0.7（让鼓主导）。

Drop B → Outro

- 最后 4 小节：执行 8.2 的鼓层淡出流程。
- Outro 第 1–2 小节：PI 片段（如 blimp_zones）在鼓层淡出期间启动并接管收束。

### 5. 跨章节过渡中的鼓层连续性

目标：在 A↔B 过渡（16 小节）保持鼓层能量锚点且不破坏频域交接。

策略:

- 鼓总线独立于 A/B 过渡总线：鼓层不参与主要 HPF/LPF 交接（或仅轻微 HPF 120→150 Hz）。
- 过渡内音量：鼓层音量基本恒定（仅轻降 0.5–1 dB）。
- 鼓型渐进切换：
  - 前 8 小节：A 型鼓型持续。
  - 后 8 小节：B 型鼓型淡入。
  - 混合比例逐步从 2:8 → 5:5 → 8:2。
  - 混合方式可采用交替播放（2 小节 A / 2 小节 B）或叠加（音量互补）。
- PI 片段处理：
  - A 片段在过渡期执行 HPF 上行；B 片段执行 LPF 下行。
- 鼓频段保持全频：20–15000 Hz（以保证锚点感）。

### 6. 实施检查清单（上线前验证）

- 鼓层时长占比 ≥ 55%？
- PI 片段启动包含 4–12 拍淡入包络？
- 鼓层与 PI 片段触发窗口错开 ≥ 0.5 拍？
- Drop A/B 时鼓层电平 ≥ PI 片段电平 +3 dB？
- 章节过渡期鼓层连续（无静音 > 2 小节）？
- 侧链压缩配置（底鼓 → Bass/Pad）已启用并调整？
- 频段分配无严重掩蔽（用频谱分析仪验证）？
- Outro 鼓层淡出 ≤ 8 小节且 PI 完成接管？

（将此清单作为每章上线前的快速验收条目，发现问题以“频段/淡入/侧链/触发时序”四项优先修正。）

## 和声/旋律预定义（实践检验配置）

- 调式优先：Am Aeolian（i–VI–III–VII）、D Dorian（i–VII–IV–i）、Gm Aeolian（i–iv–VI–VII）、C Ionian（I–V–vi–IV）、F Lydian（I–II–V–I）
- 和弦质地：triad/7th/sus2/sus4/9th；桥段少七度，Drop 多三度与五度稳定。
- 分解与琶音模式（16 步网格）：
  - A1：1–5–8–9（占空 25–33%）
  - A2：1–3–5–7（占空 30–40%）
  - A3（桥段）：1–5–6–9（弱拍上滑）
- 旋律钩子模板：
  - M1：1–3–5–8（blip_rhythm 同轮廓）
  - M2：1–2–3–5–3–2–1（square_skit 同轮廓）
  - M3：1–5–b7–6（wob_rhyth 低音插花影子）
- 声部导向：顶声部级进为主，跨越 > 六度避免；句尾回 1/5/3。

## 数学驱动的使用边界（仅加花/装饰）

- 无理相位微变（φ、√2）：仅驱动装饰触发/力度档、延迟反馈/滤波截止的离散索引；音高不使用。
- 8 字型锚点：cutoff–res、delay_wet–pan、rev_size–pre_delay 配 Lissajous 联动；章首/章尾回锚。
- 能量曲线：分段线性/指数/Logistic 控制密度/截止/反馈；Bridge 降两档，Drop B 提两档。

## 能量到参数映射（E ∈ 0–100，示例）

- 密度/力度：density = 0.3 + 0.7·E；velocity_scale = 0.5 + 0.5·E
- 开闭镲：hat_open = map(E, 0.2→0.6)
- ghost 比例：ghost_ratio = map(E, 0.1→0.35)
- cutoff：bass/pad cutoff = map(E, 600→3200 Hz)
- delay/reverb：delay_fb = map(E, 0.15→0.45)；rev_size = map(E, 0.4→0.75)
- 侧链：sidechain_db = map(E, -1.5→-4.0)
- 交叉淡：xfade_len = map(E, 8→24 拍)

## 过渡与空间（避免“惊吓”）

- 淡入规则：非鼓片段淡入 10–40 拍，先频域（LPF/HPF）后电平；A/B 总线 equal-power crossfade。
- 频域交接：A 章尾 HPF 120→800 Hz（16–32 小节），B 章头 LPF 2.5 kHz→全开；鼓总线不过滤，仅微降 0.5–1 dB。
- 空间分层：Pad/Arp 大房间（size 0.6–0.8）、鼓小房（0.2–0.3）；鼓总线并行压缩，侧链对 Pad/Bass -2.5 ~ -4 dB。

## 鼓型与填充（口述打点）

- 主型：四拍底鼓 + 2、4 拍军鼓；帽 E(16,9)；每 4 小节开闭帽微开一次。
- 过门：每 8 小节 tom/cowbell 1 小节轮问；每 16 小节 snare roll（力度渐强）。
- 峰值：Drop B 第 15–16 小节 trading 2；Crash 仅小节 1 与峰值落点。

## 质量对标与排练流程（AB 测试）

- 指标：冲击（瞬态）、清晰度（频段占位）、相位稳定（对齐/掩蔽）、过渡平滑度。
- 流程：用 snippets_/drums.rb（loop 参考）与 V02 drums（逐击）在同 BPM/同段落 AB；以 V02 为准做能量与摆动微调。
- 复现性：同无理比与初相应得同结果；每章首尾检查“8 字锚点”回归。
- 现场宏控演练：Energy、Xfade、Filter_Morph、Drummer_Enable(A/B/C)、FX_Wet；准备一键触发的 fill/solo。

## 片段使用索引（examples）

- ambient.rb（Ch1 Intro；Ch4 Intro）
- ocean.rb（Ch1 Intro；Ch3/6 Intro/Outro）
- ambient_experiment.rb（Ch1/3/5 Bridge/Intro）
- reich_phase.rb（Ch1/6 Build）
- acid.rb（Ch1/4 Build）
- blip_rhythm.rb（Ch1 Drop A；Ch4/5 Drop A/B 变体）
- square_skit.rb（Ch1/5 Drop A）
- wob_rhyth.rb（Ch1/3/6 Drop B 插花）
- chord_inversions.rb（Ch1/5 Bridge）
- echo_drama.rb（Ch1/3/5 Bridge）
- driving_pulse.rb（Ch2 Intro/Build）
- tron_bike.rb（Ch2/4/6 Drop A/B）
- rerezzed.rb（Ch2/5/6 Drop B）
- fm_noise.rb（Ch2/4/6 段尾撞点）
- idm_breakbeat.rb / filtered_dnb.rb / jungle.rb / compus_beats.rb / tilburg_2.rb（Ch3 各段）

## 混音与电平

- 余量：主总线 -6 ~ -9 dB；鼓总线 -3 dB；Pad/Arp -6 dB；新片段淡入从 -12 dB 起。
- 高频管理：帽/ride 在 10–12 kHz 轻抑；Crash 峰值不超 -8 dB。

## 排练与演出控制

- 检查点：每 8/16/32 小节锚点与 8 字回归；跨章前预置下一章片段的预滤/预延迟。
- 宏控：Energy（0–100）、Xfade（A↔B）、Filter_Morph、Drummer_Enable（A/B/C）、FX_Wet（全局）。
- 现场预案：能量不足→提前引入 acid.rb、tron_bike.rb；过热→提升 HPF、降低反馈，保持清晰度。

结果：六章节完整叙事；鼓为能量锚点与舞台焦点；examples 片段高密度融入但以淡入衔接；旋律/和声以预定义配置为主，数学仅做装饰微变，整体音乐性优先。
